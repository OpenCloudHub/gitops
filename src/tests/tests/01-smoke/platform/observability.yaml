apiVersion: k6.io/v1alpha1
kind: TestRun
metadata:
  name: smoke-platform-observability
  namespace: k6-testing
  labels:
    app.kubernetes.io/name: k6-tests
    opencloudhub.org/test-type: smoke
    opencloudhub.org/test-target: observability
spec:
  parallelism: 1
  script:
    localFile: /tests/tests/01-smoke/platform/observability.js
  arguments: --insecure-skip-tls-verify --out experimental-prometheus-rw
  cleanup: post
  runner:
    image: docker.io/opencloudhuborg/k6-tests:latest
    imagePullPolicy: Always
    env:
      - name: TEST_ENV
        value: "dev"
      - name: K6_PROMETHEUS_RW_SERVER_URL
        value: "http://prometheus-server.observability.svc.cluster.local:80/api/v1/write"
      - name: K6_PROMETHEUS_RW_TREND_AS_NATIVE_HISTOGRAM
        value: "true"
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi
